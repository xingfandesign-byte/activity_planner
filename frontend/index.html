<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Activities">
    <meta name="description" content="Personalized local activity recommendations">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.svg">
    <title>Activity Planner</title>
    <link rel="stylesheet" href="styles.css?v=2">
</head>
<body>
    <a href="#dashboard-digest-items" class="skip-link">Skip to recommendations</a>
    <div id="app" role="application">
        <!-- Loading State (shown until JS decides which screen) -->
        <div id="app-loading" class="app-loading">
            <div class="loading-content">
                <h1>ğŸ‰</h1>
                <p>Loading Activity Planner...</p>
            </div>
        </div>

        <!-- Auth Screen (Login/Signup) - Only for returning users who need to sign in -->
        <div id="auth-screen" class="screen">
            <div class="container auth-container">
                <p id="verify-email-message" class="verify-email-message" style="display:none;"></p>
                <!-- Login Form -->
                <div id="login-form" class="auth-form active">
                <h1>ğŸ‰ Activity Planner</h1>
                    <p class="subtitle">Welcome back!</p>

                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="login-email" placeholder="hello@example.com">
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="login-password" placeholder="Enter your password">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('login-password', this)" title="Show password" aria-label="Show password">
                                <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                <svg class="icon-eye-off" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                            </button>
                        </div>
                    </div>

                    <div class="checkbox-row">
                        <label><input type="checkbox" id="remember-me"> Remember me</label>
                        <a href="#" onclick="showForgotPassword()" class="forgot-link">Forgot password?</a>
                    </div>

                    <button class="btn btn-primary" onclick="handleLogin()">Sign In</button>

                    <div class="auth-divider">
                        <span>or sign in with</span>
                    </div>

                    <div class="oauth-buttons">
                        <button class="btn btn-oauth" onclick="signInWithOAuth('google')">
                            <span class="oauth-icon">G</span> Google
                        </button>
                    </div>

                    <p class="auth-switch">
                        Don't have an account? <a href="#" onclick="showSignupForm()">Sign up</a>
                    </p>

                    <p class="auth-switch">
                        <a href="#" onclick="continueAsGuest()">Continue as guest</a>
                    </p>
                </div>

                <!-- Signup Form -->
                <div id="signup-form" class="auth-form">
                    <h1>ğŸ‰ Activity Planner</h1>
                    <p class="subtitle">Get personalized activity ideas</p>

                    <div class="form-group">
                        <label>Email address</label>
                        <input type="email" id="signup-email" placeholder="hello@example.com">
                    </div>

                    <div class="form-group">
                        <label>Create a password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="signup-password" placeholder="At least 8 characters">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('signup-password', this)" title="Show password" aria-label="Show password">
                                <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                <svg class="icon-eye-off" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                            </button>
                        </div>
                        <p class="input-hint">âœ“ At least 8 characters</p>
                    </div>

                    <div class="checkbox-row">
                        <label><input type="checkbox" id="email-digest-optin" checked> Send me weekly digest emails</label>
                    </div>

                    <button class="btn btn-primary" onclick="handleSignup()">Create Account</button>

                    <div class="auth-divider">
                        <span>or continue with</span>
                    </div>

                    <div class="oauth-buttons">
                        <button class="btn btn-oauth" onclick="signInWithOAuth('google')">
                            <span class="oauth-icon">G</span> Google
                        </button>
                    </div>

                    <p class="auth-switch">
                        Already have an account? <a href="#" onclick="showLoginForm()">Sign in</a>
                    </p>

                    <p class="terms-text">
                        By continuing, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
                    </p>
                </div>

                <!-- Reset Password Form (shown when URL has ?reset_token=...) -->
                <div id="reset-password-form" class="auth-form">
                    <h1>Set new password</h1>
                    <p class="subtitle">Enter your new password below</p>
                    <input type="hidden" id="reset-token-input" value="">
                    <div class="form-group">
                        <label>New password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="reset-new-password" placeholder="At least 8 characters">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('reset-new-password', this)" title="Show password" aria-label="Show password">
                                <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                <svg class="icon-eye-off" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Confirm password</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="reset-confirm-password" placeholder="Confirm your password">
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('reset-confirm-password', this)" title="Show password" aria-label="Show password">
                                <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                <svg class="icon-eye-off" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                            </button>
                        </div>
                    </div>
                    <p id="reset-error" class="form-error" style="display:none;"></p>
                    <button class="btn btn-primary" onclick="handleResetPassword()">Update password</button>
                    <p class="auth-switch">
                        <a href="#" onclick="showLoginFormFromReset()">Back to sign in</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- Forgot Password Modal -->
        <div id="forgot-password-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeForgotPasswordModal()">&times;</span>
                <h2>Reset password</h2>
                <p class="forgot-subtitle">Enter your email and we'll send you a link to reset your password.</p>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="forgot-email" placeholder="hello@example.com">
                </div>
                <p id="forgot-message" class="forgot-message" style="display:none;"></p>
                <p id="forgot-error" class="form-error" style="display:none;"></p>
                <button class="btn btn-primary" onclick="handleForgotPassword()">Send reset link</button>
                <p class="auth-switch" style="margin-top:1rem;">
                    <a href="#" onclick="closeForgotPasswordModal(); return false;">Back to sign in</a>
                </p>
            </div>
        </div>

        <!-- First-Time Onboarding Screen -->
        <div id="onboarding" class="screen">
            <div class="container onboarding-container">
                <!-- Progress Indicator with Back Button -->
                <div class="progress-header">
                    <button id="onboarding-back-btn" class="back-chevron" onclick="goBack()" title="Back">â€¹</button>
                    <div class="progress-bar">
                        <div class="progress-step active" data-step="1">1</div>
                        <div class="progress-line"></div>
                        <div class="progress-step" data-step="2">2</div>
                        <div class="progress-line"></div>
                        <div class="progress-step" data-step="3">3</div>
                        <div class="progress-line"></div>
                        <div class="progress-step" data-step="4">4</div>
                        <div class="progress-line"></div>
                        <div class="progress-step" data-step="5">5</div>
                    </div>
                </div>

                <!-- Step 1: Group Type -->
                <div id="step-1" class="onboarding-step active" style="display: block;">
                    <h2>Who are you planning activities for?</h2>
                    <p class="subtitle">This helps us personalize your recommendations</p>

                    <div class="selection-grid">
                        <div class="selection-card" data-value="solo">
                            <div class="card-emoji">ğŸ‘¤</div>
                            <div class="card-label">Just Me</div>
                        </div>
                        <div class="selection-card" data-value="couple">
                            <div class="card-emoji">ğŸ‘«</div>
                            <div class="card-label">With Partner</div>
                        </div>
                        <div class="selection-card" data-value="family">
                            <div class="card-emoji">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                            <div class="card-label">Family with Kids</div>
                        </div>
                        <div class="selection-card" data-value="friends">
                            <div class="card-emoji">ğŸ‘¥</div>
                            <div class="card-label">With Friends</div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Location -->
                <div id="step-2" class="onboarding-step">
                    <div id="step-2a" class="substep active" style="display: block;">
                        <h2>Where are you based?</h2>
                        <p class="subtitle">We'll use this to calculate travel times</p>

                        <button id="use-location-btn" class="btn btn-location">
                            <span class="btn-icon">ğŸ“</span>
                            <span class="btn-text">Use My Current Location</span>
                            <span class="btn-subtext">For accurate travel times</span>
                        </button>

                        <button id="manual-location-btn" class="btn-link">No thanks, I'll enter manually</button>
                    </div>

                    <div id="step-2b" class="substep">
                        <h2>How would you like to enter your location?</h2>

                        <div class="selection-grid two-col">
                            <div class="selection-card" data-value="zip" id="select-zip">
                                <div class="card-emoji">ğŸ </div>
                                <div class="card-label">ZIP Code</div>
                                <div class="card-sublabel">(faster entry)</div>
                            </div>
                            <div class="selection-card" data-value="address" id="select-address">
                                <div class="card-emoji">ğŸ“</div>
                                <div class="card-label">Full Address</div>
                                <div class="card-sublabel">(exact times)</div>
                            </div>
                        </div>

                        <div id="zip-input-group" class="input-group hidden">
                            <label>Enter your ZIP code:</label>
                            <input type="text" id="zip-input" placeholder="94102" maxlength="10">
                            <p class="privacy-note">ğŸ”’ We only use this for travel times</p>
                            <button class="btn btn-primary" onclick="submitLocation('zip')">Continue â†’</button>
                        </div>

                        <div id="address-input-group" class="input-group hidden">
                            <label>Enter your address:</label>
                            <input type="text" id="address-input" placeholder="123 Main St, San Francisco, CA">
                            <p class="privacy-note">ğŸ”’ We only use this for travel times</p>
                            <button class="btn btn-primary" onclick="submitLocation('address')">Continue â†’</button>
                        </div>
                    </div>

                    <div id="step-2c" class="substep">
                        <h2>âœ“ Location set!</h2>
                        <p class="location-display" id="location-display">ğŸ“ San Francisco, CA 94102</p>

                        <label class="save-location-option">
                            <input type="checkbox" id="save-location-checkbox" onchange="handleSaveLocationCheckbox(this)">
                            <span>Save as my home location</span>
                        </label>

                        <button class="btn btn-primary" onclick="completeLocationStep()">Continue â†’</button>
                    </div>

                    <div id="step-2d" class="substep">
                        <h2>Travel Preferences</h2>

                        <div class="form-section">
                            <label>How do you get around? (select all)</label>
                            <div class="selection-grid three-col">
                                <div class="selection-card small selectable" data-value="walking">
                                    <div class="card-emoji">ğŸš¶</div>
                                    <div class="card-label">Walking/Biking</div>
                                </div>
                                <div class="selection-card small selectable selected" data-value="transit">
                                    <div class="card-emoji">ğŸš‡</div>
                                    <div class="card-label">Transit</div>
                                </div>
                                <div class="selection-card small selectable selected" data-value="car">
                                    <div class="card-emoji">ğŸš—</div>
                                    <div class="card-label">Car</div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <label>Typical departure times (select all)</label>
                            <p class="section-sublabel">Saturday:</p>
                            <div class="selection-grid three-col">
                                <div class="selection-card small selectable selected" data-day="saturday" data-value="morning">
                                    <div class="card-label">Morning</div>
                                    <div class="card-sublabel">8-10 AM</div>
                                </div>
                                <div class="selection-card small selectable" data-day="saturday" data-value="midday">
                                    <div class="card-label">Midday</div>
                                    <div class="card-sublabel">11-1 PM</div>
                                </div>
                                <div class="selection-card small selectable" data-day="saturday" data-value="afternoon">
                                    <div class="card-label">Afternoon</div>
                                    <div class="card-sublabel">2-5 PM</div>
                                </div>
                            </div>
                            <p class="section-sublabel">Sunday:</p>
                            <div class="selection-grid three-col">
                                <div class="selection-card small selectable selected" data-day="sunday" data-value="morning">
                                    <div class="card-label">Morning</div>
                                    <div class="card-sublabel">8-10 AM</div>
                                </div>
                                <div class="selection-card small selectable" data-day="sunday" data-value="midday">
                                    <div class="card-label">Midday</div>
                                    <div class="card-sublabel">11-1 PM</div>
                                </div>
                                <div class="selection-card small selectable" data-day="sunday" data-value="afternoon">
                                    <div class="card-label">Afternoon</div>
                                    <div class="card-sublabel">2-5 PM</div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <label>Max travel time (select all that apply)</label>
                            <div class="selection-grid four-col">
                                <div class="selection-card small selectable selected" data-value="0-15">
                                    <div class="card-label">&lt; 15 min</div>
                                    <div class="card-sublabel">nearby</div>
                                </div>
                                <div class="selection-card small selectable selected" data-value="15-30">
                                    <div class="card-label">15-30 min</div>
                                    <div class="card-sublabel">moderate</div>
                                </div>
                                <div class="selection-card small selectable" data-value="30-60">
                                    <div class="card-label">30-60 min</div>
                                    <div class="card-sublabel">worth it</div>
                                </div>
                                <div class="selection-card small selectable" data-value="60+">
                                    <div class="card-label">60+ min</div>
                                    <div class="card-sublabel">day trip</div>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary" onclick="goToStep(3)">Continue â†’</button>
                    </div>
                </div>

                <!-- Step 3: Interests -->
                <div id="step-3" class="onboarding-step">
                    <h2>What do you enjoy?</h2>
                    <p class="subtitle">Pick at least 3</p>

                    <div class="selection-grid three-col" id="interests-grid">
                        <div class="selection-card selectable" data-value="nature">
                            <div class="card-emoji">ğŸŒ²ğŸ•ï¸</div>
                            <div class="card-label">Nature & Parks</div>
                        </div>
                        <div class="selection-card selectable" data-value="arts_culture">
                            <div class="card-emoji">ğŸ¨ğŸ–¼ï¸</div>
                            <div class="card-label">Arts & Culture</div>
                        </div>
                        <div class="selection-card selectable" data-value="food_drinks">
                            <div class="card-emoji">ğŸ½ï¸ğŸ·</div>
                            <div class="card-label">Food & Drinks</div>
                        </div>
                        <div class="selection-card selectable" data-value="adventure">
                            <div class="card-emoji">ğŸ¢ğŸ¯</div>
                            <div class="card-label">Adventure & Sports</div>
                        </div>
                        <div class="selection-card selectable" data-value="learning">
                            <div class="card-emoji">ğŸ“šğŸ”¬</div>
                            <div class="card-label">Learning & Science</div>
                        </div>
                        <div class="selection-card selectable" data-value="entertainment">
                            <div class="card-emoji">ğŸµğŸ­</div>
                            <div class="card-label">Entertainment</div>
                        </div>
                        <div class="selection-card selectable" data-value="relaxation">
                            <div class="card-emoji">ğŸ§˜â˜•</div>
                            <div class="card-label">Relaxation</div>
                        </div>
                        <div class="selection-card selectable" data-value="shopping">
                            <div class="card-emoji">ğŸ›ï¸ğŸª</div>
                            <div class="card-label">Shopping & Markets</div>
                        </div>
                        <div class="selection-card selectable" data-value="events">
                            <div class="card-emoji">ğŸªğŸ </div>
                            <div class="card-label">Local Events</div>
                        </div>
                    </div>

                    <p class="selection-count" id="interests-count">0 selected (minimum 3)</p>

                    <button class="btn btn-primary" id="step3-continue" disabled onclick="goToStep(4)">Continue â†’</button>
                </div>

                <!-- Step 4: Activity Style -->
                <div id="step-4" class="onboarding-step">
                    <h2>What's your ideal activity vibe?</h2>

                    <div class="form-section">
                        <label>Energy Level:</label>
                        <div class="selection-grid three-col">
                            <div class="selection-card selectable" data-group="energy" data-value="relaxing">
                                <div class="card-emoji">ğŸ§˜</div>
                                <div class="card-label">Relaxing</div>
                                <div class="card-sublabel">sit, view, chill</div>
                            </div>
                            <div class="selection-card selectable selected" data-group="energy" data-value="moderate">
                                <div class="card-emoji">ğŸš¶</div>
                                <div class="card-label">Moderate</div>
                                <div class="card-sublabel">walking, exploring</div>
                            </div>
                            <div class="selection-card selectable" data-group="energy" data-value="active">
                                <div class="card-emoji">ğŸƒ</div>
                                <div class="card-label">Active</div>
                                <div class="card-sublabel">adventure, sports</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <label>How much time per activity?</label>
                        <div class="selection-grid three-col">
                            <div class="selection-card selectable" data-group="time" data-value="quick">
                                <div class="card-label">1-2 hours</div>
                                <div class="card-sublabel">Quick trip</div>
                            </div>
                            <div class="selection-card selectable selected" data-group="time" data-value="half_day">
                                <div class="card-label">3-4 hours</div>
                                <div class="card-sublabel">Half-day</div>
                            </div>
                            <div class="selection-card selectable" data-group="time" data-value="full_day">
                                <div class="card-label">5+ hours</div>
                                <div class="card-sublabel">Full day</div>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="goToStep(5)">Continue â†’</button>
                </div>

                <!-- Step 5: Constraints (Optional) -->
                <div id="step-5" class="onboarding-step">
                    <h2>A few more details</h2>
                    <p class="subtitle">Optional - you can skip this</p>

                    <div class="form-section">
                        <label>Budget per outing:</label>
                        <div class="selection-grid four-col">
                            <div class="selection-card small selectable" data-group="budget" data-value="free">
                                <div class="card-label">Free</div>
                                <div class="card-sublabel">only</div>
                            </div>
                            <div class="selection-card small selectable" data-group="budget" data-value="low">
                                <div class="card-label">&lt; $25</div>
                                <div class="card-sublabel">per person</div>
                            </div>
                            <div class="selection-card small selectable selected" data-group="budget" data-value="moderate">
                                <div class="card-label">&lt; $50</div>
                                <div class="card-sublabel">per person</div>
                            </div>
                            <div class="selection-card small selectable" data-group="budget" data-value="any">
                                <div class="card-label">No limit</div>
                                <div class="card-sublabel"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <label>Accessibility needs:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="accessibility" value="wheelchair"> Wheelchair accessible</label>
                            <label><input type="checkbox" name="accessibility" value="stroller"> Stroller friendly</label>
                            <label><input type="checkbox" name="accessibility" value="limited_walking"> Limited walking</label>
                        </div>
                    </div>

                    <div class="form-section">
                        <label>Prefer to avoid:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="avoid" value="crowds"> Crowded places</label>
                            <label><input type="checkbox" name="avoid" value="tourist"> Tourist spots</label>
                            <label><input type="checkbox" name="avoid" value="reservations"> Requires reservations</label>
                            <label><input type="checkbox" name="avoid" value="waits"> Long wait times</label>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="completeOnboarding()">ğŸ‰ Show My Recommendations</button>
                </div>

                <!-- Sign in / Sign up link for existing users -->
                <p class="onboarding-auth-link">
                    Already have an account? <a href="#" onclick="showAuthFromOnboarding('login')">Sign in</a> Â·
                    Want to register? <a href="#" onclick="showAuthFromOnboarding('signup')">Sign up</a>
                </p>
            </div>
        </div>

        <!-- Returning User Dashboard -->
        <div id="dashboard" class="screen">
            <div class="container dashboard-container">
                <header class="dashboard-header">
                    <h1>Activity Planner</h1>
                    <div class="header-actions">
                        <button id="settings-btn" class="btn btn-secondary" onclick="openSettings()">Settings</button>
                        <button id="signout-btn" class="btn btn-secondary" onclick="handleSignOut()">Sign Out</button>
                    </div>
                </header>

                <div class="welcome-banner">
                    <h2>Welcome back, <span id="user-name">there</span>! ğŸ‘‹</h2>
                    <p>Here's what's happening near you.</p>
                </div>

                <!-- Quick Adjustments - Now at the top -->
                <div class="quick-adjustments">
                    <h3>Quick Adjustments</h3>
                    <p class="quick-adjustments-note">These are temporary - your saved preferences won't change</p>

                    <div class="quick-row">
                        <div class="form-group">
                            <label>Location</label>
                            <select id="quick-location" onchange="onQuickAdjustmentChange()">
                                <option value="">ğŸ“ Use saved location</option>
                                <option value="current">ğŸ“ Use current location</option>
                                <option value="custom">âœï¸ Enter new location...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Planning for</label>
                            <div class="quick-toggle-group">
                                <button class="quick-toggle" data-value="solo" onclick="selectQuickGroup(this)">ğŸ‘¤</button>
                                <button class="quick-toggle" data-value="couple" onclick="selectQuickGroup(this)">ğŸ‘«</button>
                                <button class="quick-toggle active" data-value="family" onclick="selectQuickGroup(this)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</button>
                                <button class="quick-toggle" data-value="friends" onclick="selectQuickGroup(this)">ğŸ‘¥</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Max travel time</label>
                        <div class="quick-toggle-group travel-time-toggles">
                            <button class="quick-toggle active" data-value="0-15" onclick="toggleQuickTravelTime(this)">&lt; 15 min</button>
                            <button class="quick-toggle active" data-value="15-30" onclick="toggleQuickTravelTime(this)">15-30 min</button>
                            <button class="quick-toggle" data-value="30-60" onclick="toggleQuickTravelTime(this)">30-60 min</button>
                            <button class="quick-toggle" data-value="60+" onclick="toggleQuickTravelTime(this)">60+ day trip</button>
                        </div>
                    </div>
                </div>

                <!-- Recommendations Section -->
                <div class="dashboard-recommendations">
                    <div class="section-header">
                        <h3 id="recommendations-heading">ğŸ‰ Recommended Activities</h3>
                        <button class="btn-link" onclick="refreshRecommendations()" aria-label="Refresh recommendations"><span class="refresh-icon" aria-hidden="true">â†»</span> Refresh</button>
                    </div>
                    <div id="dashboard-digest-items" class="digest-grid" role="region" aria-labelledby="recommendations-heading" aria-live="polite">
                        <div class="loading" id="dashboard-loading">Loading recommendations...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal" role="dialog" aria-modal="true" aria-label="Settings">
            <div class="modal-content modal-large">
                <span class="close" onclick="closeSettings()" role="button" aria-label="Close settings" tabindex="0">&times;</span>
                <h2>Settings</h2>

                <div class="settings-tabs">
                    <button class="settings-tab active" onclick="showSettingsTab('preferences')">Preferences</button>
                    <button class="settings-tab" onclick="showSettingsTab('saved')">Saved</button>
                    <button class="settings-tab" onclick="showSettingsTab('been')">Been</button>
                    <button class="settings-tab" onclick="showSettingsTab('interests')">Interests</button>
                    <button class="settings-tab" onclick="showSettingsTab('account')">Account</button>
                    <button class="settings-tab" onclick="showSettingsTab('notifications')">Notifications</button>
                </div>

                <!-- Preferences Tab -->
                <div id="settings-preferences" class="settings-tab-content active">
                    <div class="preferences-summary">
                        <!-- Location -->
                        <div class="pref-card">
                            <div class="pref-card-header">
                                <span class="pref-icon">ğŸ“</span>
                                <span class="pref-title">Home Location</span>
                                <button class="btn-edit" onclick="editPreference('location')">Edit</button>
                            </div>
                            <div class="pref-card-content">
                                <p id="pref-location">San Francisco, CA 94102</p>
                                <p class="pref-sublabel">Used as default starting point</p>
                            </div>
                        </div>

                        <!-- Planning For -->
                        <div class="pref-card">
                            <div class="pref-card-header">
                                <span class="pref-icon" id="pref-group-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                                <span class="pref-title">Default Planning For</span>
                                <button class="btn-edit" onclick="editPreference('group')">Edit</button>
                            </div>
                            <div class="pref-card-content">
                                <p id="pref-group">Family with Kids</p>
                            </div>
                        </div>

                        <!-- Travel Preferences -->
                        <div class="pref-card">
                            <div class="pref-card-header">
                                <span class="pref-icon">ğŸš—</span>
                                <span class="pref-title">Travel Preferences</span>
                                <button class="btn-edit" onclick="editPreference('travel')">Edit</button>
                            </div>
                            <div class="pref-card-content">
                                <p><strong>Transportation:</strong> <span id="pref-transport">Car, Transit</span></p>
                                <p><strong>Max travel time:</strong> <span id="pref-travel-time">15-30 min</span></p>
                                <p><strong>Departure:</strong> <span id="pref-departure">Saturday morning, Sunday morning</span></p>
                            </div>
                        </div>

                        <!-- Interests -->
                        <div class="pref-card">
                            <div class="pref-card-header">
                                <span class="pref-icon">ğŸ¯</span>
                                <span class="pref-title">Interests</span>
                                <button class="btn-edit" onclick="editPreference('interests')">Edit</button>
                            </div>
                            <div class="pref-card-content">
                                <div class="interest-tags" id="pref-interests">
                                    <span class="tag">ğŸŒ² Nature & Parks</span>
                                    <span class="tag">ğŸ¨ Arts & Culture</span>
                                    <span class="tag">ğŸ½ï¸ Food & Drinks</span>
                                </div>
                            </div>
                        </div>

                        <!-- Ideal Vibe -->
                        <div class="pref-card">
                            <div class="pref-card-header">
                                <span class="pref-icon">ğŸ§˜</span>
                                <span class="pref-title">Ideal Vibe</span>
                                <button class="btn-edit" onclick="editPreference('vibe')">Edit</button>
                            </div>
                            <div class="pref-card-content">
                                <p><strong>Energy:</strong> <span id="pref-energy">Moderate (walking, exploring)</span></p>
                                <p><strong>Time:</strong> <span id="pref-time-commit">Half-day (3-4 hours)</span></p>
                                <p><strong>Budget:</strong> <span id="pref-budget">Under $50 per person</span></p>
                            </div>
                        </div>

                        <!-- Other Preferences -->
                        <div class="pref-card">
                            <div class="pref-card-header">
                                <span class="pref-icon">âš™ï¸</span>
                                <span class="pref-title">Other Preferences</span>
                                <button class="btn-edit" onclick="editPreference('other')">Edit</button>
                            </div>
                            <div class="pref-card-content" id="pref-other">
                                <p>âœ“ Kid-friendly activities</p>
                                <p>âœ“ Stroller friendly</p>
                                <p>Avoiding: Crowds, Long waits</p>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-secondary" onclick="editAllPreferences()">Redo Full Onboarding</button>
                </div>

                <!-- Saved Places Tab -->
                <div id="settings-saved" class="settings-tab-content">
                    <div class="list-header">
                        <h3>â­ Saved Places</h3>
                        <p class="list-description">Places you've favorited for later</p>
                    </div>
                    <div id="saved-places-list" class="places-list">
                        <div class="list-loading">Loading...</div>
                    </div>
                    <div id="saved-empty" class="list-empty" style="display: none;">
                        <div class="empty-icon">â­</div>
                        <p>No saved places yet</p>
                        <p class="empty-hint">Tap the star on any recommendation to save it here</p>
                    </div>
                </div>

                <!-- Been Places Tab -->
                <div id="settings-been" class="settings-tab-content">
                    <div class="list-header">
                        <h3>âœ… Places You've Been</h3>
                        <p class="list-description">These won't appear in future recommendations</p>
                    </div>
                    <div id="been-places-list" class="places-list">
                        <div class="list-loading">Loading...</div>
                    </div>
                    <div id="been-empty" class="list-empty" style="display: none;">
                        <div class="empty-icon">âœ…</div>
                        <p>No places marked as visited</p>
                        <p class="empty-hint">Mark places you've already been to exclude them from recommendations</p>
                    </div>
                </div>

                <!-- Interests Tab -->
                <div id="settings-interests" class="settings-tab-content">
                    <div class="pref-card">
                        <div class="pref-card-header">
                            <span class="pref-icon">ğŸ§ </span>
                            <span class="pref-title">Learned Preferences</span>
                        </div>
                        <div class="pref-card-content">
                            <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">These are learned from your saves, visits, likes, and clicks. They influence how recommendations are ranked for you.</p>
                            <div id="interest-profile-content">
                                <p style="color: #999;">Loading...</p>
                            </div>
                            <div style="margin-top: 1.5rem; border-top: 1px solid #e5e7eb; padding-top: 1rem;">
                                <button class="btn btn-secondary" onclick="resetInterestProfile(false)" style="margin-right: 0.5rem;">Reset Ranking</button>
                                <button class="btn btn-secondary" onclick="resetInterestProfile(true)" style="background: #fef2f2; color: #ef4444; border-color: #fecaca;">Reset All Data</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Interests Tab -->
                <div id="settings-interests" class="settings-tab-content">
                    <div class="pref-card">
                        <div class="pref-card-header">
                            <span class="pref-icon">ğŸ¯</span>
                            <span class="pref-title">Your Learned Preferences</span>
                        </div>
                        <div class="pref-card-content">
                            <p class="pref-sublabel">Based on your activity (saves, visits, thumbs up/down)</p>
                            <div id="affinity-loading" class="list-loading" style="display: none;">Loading...</div>
                            <div id="affinity-content">
                                <div id="affinity-list" class="affinity-list"></div>
                                <div id="affinity-stats" class="affinity-stats"></div>
                            </div>
                            <button class="btn btn-secondary" onclick="resetAffinityScores()">Reset All Preferences</button>
                        </div>
                    </div>
                </div>
                
                <!-- Account Tab -->
                <div id="settings-account" class="settings-tab-content">
                    <div class="pref-card">
                        <div class="pref-card-header">
                            <span class="pref-icon">ğŸ‘¤</span>
                            <span class="pref-title">Account Info</span>
                        </div>
                        <div class="pref-card-content">
                            <p><strong>Email:</strong> <span id="account-email">user@example.com</span></p>
                            <p><strong>Member since:</strong> <span id="account-since">January 2026</span></p>
                        </div>
                    </div>

                    <div class="pref-card">
                        <div class="pref-card-header">
                            <span class="pref-icon">ğŸ”’</span>
                            <span class="pref-title">Security</span>
                        </div>
                        <div class="pref-card-content">
                            <button class="btn btn-secondary" onclick="changePassword()">Change Password</button>
                        </div>
                    </div>

                    <div class="pref-card danger">
                        <div class="pref-card-header">
                            <span class="pref-icon">âš ï¸</span>
                            <span class="pref-title">Danger Zone</span>
                        </div>
                        <div class="pref-card-content">
                            <button class="btn btn-danger" onclick="deleteAccount()">Delete Account</button>
                            <p class="pref-sublabel">This action cannot be undone</p>
                        </div>
                    </div>
                </div>

                <!-- Notifications Tab -->
                <div id="settings-notifications" class="settings-tab-content">
                    <div class="pref-card">
                        <div class="pref-card-header">
                            <span class="pref-icon">ğŸ“§</span>
                            <span class="pref-title">Email Notifications</span>
                        </div>
                        <div class="pref-card-content">
                            <label class="toggle-label">
                                <input type="checkbox" id="notif-weekly" checked>
                                <span>Weekly activity digest</span>
                            </label>
                            <label class="toggle-label">
                                <input type="checkbox" id="notif-events">
                                <span>Special events near me</span>
                            </label>
                            <label class="toggle-label">
                                <input type="checkbox" id="notif-deals">
                                <span>Deals and promotions</span>
                            </label>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="saveNotificationSettings()">Save Preferences</button>
                </div>
            </div>
        </div>

        <!-- Full Screen Planner (optional expanded view) -->
        <div id="planner" class="screen">
            <div class="container">
                <header>
                    <h1>Activity Planner</h1>
                    <div class="header-actions">
                        <button id="back-to-dashboard" class="btn btn-secondary" onclick="showDashboard()">â† Dashboard</button>
                        <button id="refresh-btn" class="btn btn-secondary" onclick="loadDigest()">â†» Refresh</button>
                    </div>
                </header>

                <div id="digest-container">
                    <div class="loading" id="loading">Loading activity ideas...</div>
                    <div id="digest-items" class="digest-grid"></div>
                </div>
            </div>
        </div>

        <!-- Edit Preference Modal -->
        <div id="edit-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeEditModal()">&times;</span>
                <h2 id="edit-modal-title">Edit Preference</h2>
                <div id="edit-modal-content"></div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="savePreferenceEdit()">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Recommendation Detail Modal -->
        <div id="detail-modal" class="modal" role="dialog" aria-modal="true" aria-label="Activity details">
            <div class="modal-content">
                <span class="close" role="button" aria-label="Close" tabindex="0">&times;</span>
                <div id="detail-content"></div>
            </div>
        </div>

        <!-- Signup Prompt Modal (after onboarding) -->
        <div id="signup-prompt-modal" class="modal">
            <div class="modal-content signup-prompt">
                <h2>ğŸ‰ You're all set!</h2>
                <p class="prompt-subtitle">Want to save your preferences for next time?</p>

                <div class="prompt-benefits">
                    <div class="benefit-item">
                        <span class="benefit-icon">ğŸ’¾</span>
                        <span>Save your preferences</span>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">ğŸ“§</span>
                        <span>Get weekly activity ideas</span>
                    </div>
                    <div class="benefit-item">
                        <span class="benefit-icon">âš¡</span>
                        <span>Faster recommendations next time</span>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="signupFromPrompt()">Create Free Account</button>

                <div class="auth-divider">
                    <span>or</span>
                </div>

                <button class="btn btn-oauth btn-oauth-full" onclick="signInWithOAuth('google'); closeSignupPrompt();">
                    <span class="oauth-icon">G</span> Continue with Google
                </button>

                <p class="auth-switch">
                    <a href="#" onclick="skipSignupAndContinue()">Skip for now - show me recommendations</a>
                </p>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="app.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').catch(() => {});
      }
    </script>
</body>
</html>
